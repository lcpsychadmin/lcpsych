{% extends "base.html" %}
{% block title %}Manage Services | L+C Psych{% endblock %}

{% block head_extra %}
{% include "accounts/partials/settings_nav_styles.html" %}
<style>
.table-card { width: 100%; border-collapse: collapse; }
.table-card td,
.table-card th { padding: 0.75rem 1rem; border-bottom: 1px solid rgba(15, 63, 70, 0.12); text-align: left; }
.table-card th { font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(15, 63, 70, 0.68); }
.action-btn { border-radius: 0.75rem; border: 1px solid rgba(15, 63, 70, 0.14); padding: 0.45rem 0.9rem; font-size: 0.85rem; font-weight: 600; color: #0f3f46; background: #fff; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.3rem; }
.action-btn:hover,
.action-btn:focus-visible { background: #92DCE5; color: #005F6B; outline: none; box-shadow: 0 0 0 3px rgba(146, 220, 229, 0.45); }
.btn-primary { background: #3C9C64; color: #fff; border-radius: 0.75rem; padding: 0.65rem 1.6rem; font-weight: 600; border: 0; transition: background 0.2s ease, color 0.2s ease; }
.btn-primary:hover,
.btn-primary:focus-visible { background: #92DCE5; color: #005F6B; outline: none; box-shadow: 0 0 0 4px rgba(146, 220, 229, 0.45); }
.card-surface { background: #fff; border-radius: 1.25rem; box-shadow: 0 15px 40px rgba(0, 48, 57, 0.05); border: 1px solid rgba(146, 220, 229, 0.35); }
.field-label { color: #0f3f46; font-weight: 600; display: block; margin-bottom: 0.35rem; }
.help-text { margin-top: 0.25rem; font-size: 0.85rem; color: rgba(15, 63, 70, 0.7); }
.input-basic { width: 100%; padding: 0.625rem 0.875rem; border-radius: 0.75rem; border: 1.5px solid rgba(146, 220, 229, 0.7); background: rgba(255, 255, 255, 0.96); transition: border-color 0.2s ease, box-shadow 0.2s ease; }
.input-basic:focus { border-color: #92DCE5; box-shadow: 0 0 0 4px rgba(146, 220, 229, 0.55); outline: none; }
.error-text { color: #b91c1c; font-size: 0.85rem; margin-top: 0.35rem; }
.status-pill { display: inline-flex; align-items: center; padding: 0.15rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; background: rgba(146, 220, 229, 0.25); color: #0f3f46; text-transform: uppercase; letter-spacing: 0.05em; }
.preview-card { position: relative; padding: 1.5rem; border-radius: 1rem; background: linear-gradient(135deg, rgba(0, 72, 82, 0.85), rgba(0, 72, 82, 0.45)); color: #fff; overflow: hidden; }
.preview-card::after { content: ""; position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0.35; z-index: 0; border-radius: inherit; background-image: var(--preview-bg, none); }
.preview-card > * { position: relative; z-index: 10; }
.preview-card h3 { margin: 0 0 0.5rem; font-size: 1.4rem; }
.preview-card p { margin: 0 0 0.75rem; font-size: 0.95rem; }
.preview-card a { display: inline-flex; align-items: center; gap: 0.35rem; font-weight: 600; color: #92DCE5; }
.thumbnail { width: 100%; padding-top: 56%; background-size: cover; background-position: center; border-radius: 1rem; border: 1px solid rgba(15, 63, 70, 0.12); }
.table-actions { display: flex; flex-direction: column; gap: 0.4rem; }
@media (min-width: 768px) { .table-actions { flex-direction: row; } }
.no-wrap { white-space: nowrap; }
</style>
{% endblock %}

{% block content %}
<main id="content">
  <section class="relative overflow-hidden z-10 bg-brand-deep text-white pb-16 pt-16">
    <div class="max-w-[1100px] mx-auto px-4 text-center">
      <h1 class="text-4xl leading-tight font-semibold m-0">Manage services</h1>
      <p class="mt-3 mx-auto max-w-[760px] text-white/90 text-lg">Create rich service pages and control how they appear on the homepage cards.</p>
    </div>
  </section>

     <section class="relative z-20 py-10 md:py-14 bg-brand-accent">
    <div class="elementor-1393">
           <div class="elementor-element elementor-element-a80adf4" >
                <div class="e-con-inner">
                    <div class="elementor-shape elementor-shape-top" aria-hidden="true" data-negative="false">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 283.5 27.8" preserveAspectRatio="none">
                            <path class="elementor-shape-fill" d="M283.5,9.7c0,0-7.3,4.3-14,4.6c-6.8,0.3-12.6,0-20.9-1.5c-11.3-2-33.1-10.1-44.7-5.7 s-12.1,4.6-18,7.4c-6.6,3.2-20,9.6-36.6,9.3C131.6,23.5,99.5,7.2,86.3,8c-1.4,0.1-6.6,0.8-10.5,2c-3.8,1.2-9.4,3.8-17,4.7 c-3.2,0.4-8.3,1.1-14.2,0.9c-1.5-0.1-6.3-0.4-12-1.6c-5.7-1.2-11-3.1-15.8-3.7C6.5,9.2,0,10.8,0,10.8V0h283.5V9.7z M260.8,11.3 c-0.7-1-2-0.4-4.3-0.4c-2.3,0-6.1-1.2-5.8-1.1c0.3,0.1,3.1,1.5,6,1.9C259.7,12.2,261.4,12.3,260.8,11.3z M242.4,8.6 c0,0-2.4-0.2-5.6-0.9c-3.2-0.8-10.3-2.8-15.1-3.5c-8.2-1.1-15.8,0-15.1,0.1c0.8,0.1,9.6-0.6,17.6,1.1c3.3,0.7,9.3,2.2,12.4,2.7 C239.9,8.7,242.4,8.6,242.4,8.6z M185.2,8.5c1.7-0.7-13.3,4.7-18.5,6.1c-2.1,0.6-6.2,1.6-10,2c-3.9,0.4-8.9,0.4-8.8,0.5 c0,0.2,5.8,0.8,11.2,0c5.4-0.8,5.2-1.1,7.6-1.6C170.5,14.7,183.5,9.2,185.2,8.5z M199.1,6.9c0.2,0-0.8-0.4-4.8,1.1 c-4,1.5-6.7,3.5-6.9,3.7c-0.2,0.1,3.5-1.8,6.6-3C197,7.5,199,6.9,199.1,6.9z M283,6c-0.1,0.1-1.9,1.1-4.8,2.5s-6.9,2.8-6.7,2.7 c0.2,0,3.5-0.6,7.4-2.5C282.8,6.8,283.1,5.9,283,6z M31.3,11.6c0.1-0.2-1.9-0.2-4.5-1.2s-5.4-1.6-7.8-2C15,7.6,7.3,8.5,7.7,8.6 C8,8.7,15.9,8.3,20.2,9.3c2.2,0.5,2.4,0.5,5.7,1.6S31.2,11.9,31.3,11.6z M73,9.2c0.4-0.1,3.5-1.6,8.4-2.6c4.9-1.1,8.9-0.5,8.9-0.8 c0-0.3-1-0.9-6.2-0.3S72.6,9.3,73,9.2z M71.6,6.7C71.8,6.8,75,5.4,77.3,5c2.3-0.3,1.9-0.5,1.9-0.6c0-0.1-1.1-0.2-2.7,0.2 C74.8,5.1,71.4,6.6,71.6,6.7z M93.6,4.4c0.1,0.2,3.5,0.8,5.6,1.8c2.1,1,1.8,0.6,1.9,0.5c0.1-0.1-0.8-0.8-2.4-1.3 C97.1,4.8,93.5,4.2,93.6,4.4z M65.4,11.1c-0.1,0.3,0.3,0.5,1.9-0.2s2.6-1.3,2.2-1.2s-0.9,0.4-2.5,0.8C65.3,10.9,65.5,10.8,65.4,11.1 z M34.5,12.4c-0.2,0,2.1,0.8,3.3,0.9c1.2,0.1,2,0.1,2-0.2c0-0.3-0.1-0.5-1.6-0.4C36.6,12.8,34.7,12.4,34.5,12.4z M152.2,21.1 c-0.1,0.1-2.4-0.3-7.5-0.3c-5,0-13.6-2.4-17.2-3.5c-3.6-1.1,10,3.9,16.5,4.1C150.5,21.6,152.3,21,152.2,21.1z"/>
                            <path class="elementor-shape-fill" d="M269.6,18c-0.1-0.1-4.6,0.3-7.2,0c-7.3-0.7-17-3.2-16.6-2.9c0.4,0.3,13.7,3.1,17,3.3 C267.7,18.8,269.7,18,269.6,18z"/>
                            <path class="elementor-shape-fill" d="M227.4,9.8c-0.2-0.1-4.5-1-9.5-1.2c-5-0.2-12.7,0.6-12.3,0.5c0.3-0.1,5.9-1.8,13.3-1.2 S227.6,9.9,227.4,9.8z"/>
                            <path class="elementor-shape-fill" d="M204.5,13.4c-0.1-0.1,2-1,3.2-1.1c1.2-0.1,2,0,2,0.3c0,0.3-0.1,0.5-1.6,0.4 C206.4,12.9,204.6,13.5,204.5,13.4z"/>
                            <path class="elementor-shape-fill" d="M201,10.6c0-0.1-4.4,1.2-6.3,2.2c-1.9,0.9-6.2,3.1-6.1,3.1c0.1,0.1,4.2-1.6,6.3-2.6 S201,10.7,201,10.6z"/>
                            <path class="elementor-shape-fill" d="M154.5,26.7c-0.1-0.1-4.6,0.3-7.2,0c-7.3-0.7-17-3.2-16.6-2.9c0.4,0.3,13.7,3.1,17,3.3 C152.6,27.5,154.6,26.8,154.5,26.7z"/>
                            <path class="elementor-shape-fill" d="M41.9,19.3c0,0,1.2-0.3,2.9-0.1c1.7,0.2,5.8,0.9,8.2,0.7c4.2-0.4,7.4-2.7,7-2.6 c-0.4,0-4.3,2.2-8.6,1.9c-1.8-0.1-5.1-0.5-6.7-0.4S41.9,19.3,41.9,19.3z"/>
                            <path class="elementor-shape-fill" d="M75.5,12.6c0.2,0.1,2-0.8,4.3-1.1c2.3-0.2,2.1-0.3,2.1-0.5c0-0.1-1.8-0.4-3.4,0 C76.9,11.5,75.3,12.5,75.5,12.6z"/>
                            <path class="elementor-shape-fill" d="M15.6,13.2c0-0.1,4.3,0,6.7,0.5c2.4,0.5,5,1.9,5,2c0,0.1-2.7-0.8-5.1-1.4 C19.9,13.7,15.7,13.3,15.6,13.2z"/>
                        </svg>
                    </div>
                    <div class="elementor-shape elementor-shape-bottom" aria-hidden="true" data-negative="false">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 283.5 27.8" preserveAspectRatio="none">
                            <path class="elementor-shape-fill" d="M283.5,9.7c0,0-7.3,4.3-14,4.6c-6.8,0.3-12.6,0-20.9-1.5c-11.3-2-33.1-10.1-44.7-5.7 s-12.1,4.6-18,7.4c-6.6,3.2-20,9.6-36.6,9.3C131.6,23.5,99.5,7.2,86.3,8c-1.4,0.1-6.6,0.8-10.5,2c-3.8,1.2-9.4,3.8-17,4.7 c-3.2,0.4-8.3,1.1-14.2,0.9c-1.5-0.1-6.3-0.4-12-1.6c-5.7-1.2-11-3.1-15.8-3.7C6.5,9.2,0,10.8,0,10.8V0h283.5V9.7z M260.8,11.3 c-0.7-1-2-0.4-4.3-0.4c-2.3,0-6.1-1.2-5.8-1.1c0.3,0.1,3.1,1.5,6,1.9C259.7,12.2,261.4,12.3,260.8,11.3z M242.4,8.6 c0,0-2.4-0.2-5.6-0.9c-3.2-0.8-10.3-2.8-15.1-3.5c-8.2-1.1-15.8,0-15.1,0.1c0.8,0.1,9.6-0.6,17.6,1.1c3.3,0.7,9.3,2.2,12.4,2.7 C239.9,8.7,242.4,8.6,242.4,8.6z M185.2,8.5c1.7-0.7-13.3,4.7-18.5,6.1c-2.1,0.6-6.2,1.6-10,2c-3.9,0.4-8.9,0.4-8.8,0.5 c0,0.2,5.8,0.8,11.2,0c5.4-0.8,5.2-1.1,7.6-1.6C170.5,14.7,183.5,9.2,185.2,8.5z M199.1,6.9c0.2,0-0.8-0.4-4.8,1.1 c-4,1.5-6.7,3.5-6.9,3.7c-0.2,0.1,3.5-1.8,6.6-3C197,7.5,199,6.9,199.1,6.9z M283,6c-0.1,0.1-1.9,1.1-4.8,2.5s-6.9,2.8-6.7,2.7 c0.2,0,3.5-0.6,7.4-2.5C282.8,6.8,283.1,5.9,283,6z M31.3,11.6c0.1-0.2-1.9-0.2-4.5-1.2s-5.4-1.6-7.8-2C15,7.6,7.3,8.5,7.7,8.6 C8,8.7,15.9,8.3,20.2,9.3c2.2,0.5,2.4,0.5,5.7,1.6S31.2,11.9,31.3,11.6z M73,9.2c0.4-0.1,3.5-1.6,8.4-2.6c4.9-1.1,8.9-0.5,8.9-0.8 c0-0.3-1-0.9-6.2-0.3S72.6,9.3,73,9.2z M71.6,6.7C71.8,6.8,75,5.4,77.3,5c2.3-0.3,1.9-0.5,1.9-0.6c0-0.1-1.1-0.2-2.7,0.2 C74.8,5.1,71.4,6.6,71.6,6.7z M93.6,4.4c0.1,0.2,3.5,0.8,5.6,1.8c2.1,1,1.8,0.6,1.9,0.5c0.1-0.1-0.8-0.8-2.4-1.3 C97.1,4.8,93.5,4.2,93.6,4.4z M65.4,11.1c-0.1,0.3,0.3,0.5,1.9-0.2s2.6-1.3,2.2-1.2s-0.9,0.4-2.5,0.8C65.3,10.9,65.5,10.8,65.4,11.1 z M34.5,12.4c-0.2,0,2.1,0.8,3.3,0.9c1.2,0.1,2,0.1,2-0.2c0-0.3-0.1-0.5-1.6-0.4C36.6,12.8,34.7,12.4,34.5,12.4z M152.2,21.1 c-0.1,0.1-2.4-0.3-7.5-0.3c-5,0-13.6-2.4-17.2-3.5c-3.6-1.1,10,3.9,16.5,4.1C150.5,21.6,152.3,21,152.2,21.1z"/>
                            <path class="elementor-shape-fill" d="M269.6,18c-0.1-0.1-4.6,0.3-7.2,0c-7.3-0.7-17-3.2-16.6-2.9c0.4,0.3,13.7,3.1,17,3.3 C267.7,18.8,269.7,18,269.6,18z"/>
                            <path class="elementor-shape-fill" d="M227.4,9.8c-0.2-0.1-4.5-1-9.5-1.2c-5-0.2-12.7,0.6-12.3,0.5c0.3-0.1,5.9-1.8,13.3-1.2 S227.6,9.9,227.4,9.8z"/>
                            <path class="elementor-shape-fill" d="M204.5,13.4c-0.1-0.1,2-1,3.2-1.1c1.2-0.1,2,0,2,0.3c0,0.3-0.1,0.5-1.6,0.4 C206.4,12.9,204.6,13.5,204.5,13.4z"/>
                            <path class="elementor-shape-fill" d="M201,10.6c0-0.1-4.4,1.2-6.3,2.2c-1.9,0.9-6.2,3.1-6.1,3.1c0.1,0.1,4.2-1.6,6.3-2.6 S201,10.7,201,10.6z"/>
                            <path class="elementor-shape-fill" d="M154.5,26.7c-0.1-0.1-4.6,0.3-7.2,0c-7.3-0.7-17-3.2-16.6-2.9c0.4,0.3,13.7,3.1,17,3.3 C152.6,27.5,154.6,26.8,154.5,26.7z"/>
                            <path class="elementor-shape-fill" d="M41.9,19.3c0,0,1.2-0.3,2.9-0.1c1.7,0.2,5.8,0.9,8.2,0.7c4.2-0.4,7.4-2.7,7-2.6 c-0.4,0-4.3,2.2-8.6,1.9c-1.8-0.1-5.1-0.5-6.7-0.4S41.9,19.3,41.9,19.3z"/>
                            <path class="elementor-shape-fill" d="M75.5,12.6c0.2,0.1,2-0.8,4.3-1.1c2.3-0.2,2.1-0.3,2.1-0.5c0-0.1-1.8-0.4-3.4,0 C76.9,11.5,75.3,12.5,75.5,12.6z"/>
                            <path class="elementor-shape-fill" d="M15.6,13.2c0-0.1,4.3,0,6.7,0.5c2.4,0.5,5,1.9,5,2c0,0.1-2.7-0.8-5.1-1.4 C19.9,13.7,15.7,13.3,15.6,13.2z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    <div class="max-w-[1200px] mx-auto px-4">
      {{ form.media }}
      <div class="settings-layout">
        {% include "accounts/partials/settings_nav.html" %}

        <div class="space-y-10">
          <div class="card-surface p-6 md:p-8">
            <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
              <div>
                <h2 class="text-2xl font-semibold text-[#0f3f46] m-0">{% if editing %}Update service{% else %}Add a service{% endif %}</h2>
                <p class="text-slate-600 mt-2 mb-0">These services power the homepage cards and generate their own SEO-friendly detail pages.</p>
              </div>
            </div>

        {% if form.non_field_errors %}
          <div class="mt-4 text-sm text-[#b91c1c]">{{ form.non_field_errors }}</div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" class="mt-6 space-y-6">
          {% csrf_token %}
          {% if editing %}
            <input type="hidden" name="object_id" value="{{ editing.id }}">
          {% endif %}

          <div class="grid md:grid-cols-2 gap-5">
            <div class="space-y-5">
              <div>
                <label class="field-label" for="{{ form.title.id_for_label }}">Title</label>
                {{ form.title }}
                {% if form.title.errors %}
                  <div class="error-text">{{ form.title.errors|striptags }}</div>
                {% endif %}
              </div>
              {% if form.cta_label %}
              <div>
                <label class="field-label" for="{{ form.cta_label.id_for_label }}">CTA label</label>
                {{ form.cta_label }}
                {% if form.cta_label.errors %}
                  <div class="error-text">{{ form.cta_label.errors|striptags }}</div>
                {% endif %}
                {% if form.cta_label.help_text %}
                  <p class="help-text">{{ form.cta_label.help_text }}</p>
                {% endif %}
              </div>
              {% endif %}
              <div>
                <label class="field-label" for="{{ form.hero_heading.id_for_label }}">Hero heading</label>
                {{ form.hero_heading }}
                {% if form.hero_heading.errors %}
                  <div class="error-text">{{ form.hero_heading.errors|striptags }}</div>
                {% endif %}
              </div>
              <div>
                <label class="field-label" for="{{ form.hero_subheading.id_for_label }}">Hero introduction</label>
                {{ form.hero_subheading }}
                {% if form.hero_subheading.errors %}
                  <div class="error-text">{{ form.hero_subheading.errors|striptags }}</div>
                {% endif %}
              </div>
              <div>
                <label class="field-label" for="{{ form.page.id_for_label }}">Legacy page fallback</label>
                {{ form.page }}
                {% if form.page.errors %}
                  <div class="error-text">{{ form.page.errors|striptags }}</div>
                {% endif %}
                <p class="help-text">Optional: select an imported page to populate the detail body when no rich content is provided.</p>
              </div>
            </div>

            <div class="space-y-5">
              <div>
                <label class="field-label" for="{{ form.background_image.id_for_label }}">Upload background image</label>
                {{ form.background_image }}
                {% if form.background_image.errors %}
                  <div class="error-text">{{ form.background_image.errors|striptags }}</div>
                {% endif %}
                {% if editing and editing.card_background_url %}
                  <p class="help-text">Current image shown below. Upload a new file to replace it or check the clear box to remove.</p>
                  <div class="thumbnail" style="background-image: url('{{ editing.card_background_url }}');"></div>
                {% endif %}
              </div>
              <div>
                <label class="field-label" for="{{ form.image_url.id_for_label }}">Fallback background image URL</label>
                {{ form.image_url }}
                {% if form.image_url.errors %}
                  <div class="error-text">{{ form.image_url.errors|striptags }}</div>
                {% endif %}
                {% if form.image_url.help_text %}
                  <p class="help-text">{{ form.image_url.help_text }}</p>
                {% endif %}
              </div>
              <div>
                <label class="field-label" for="{{ form.body.id_for_label }}">Detail page content</label>
                {{ form.body }}
                {% if form.body.errors %}
                  <div class="error-text">{{ form.body.errors|striptags }}</div>
                {% endif %}
                <p class="help-text">Leave blank to pull content from a connected legacy page.</p>
              </div>
              {% if editing %}
                <div class="preview-card"{% if editing.card_background_url %} style="--preview-bg: url('{{ editing.card_background_url }}');"{% endif %}>
                  <h3>{{ editing.hero_title }}</h3>
                  <p>{{ editing.hero_intro|default:"Add a hero introduction to personalize the detail page." }}</p>
                  <a href="{{ editing.get_absolute_url }}" target="_blank" rel="noopener">Preview live page →</a>
                </div>
              {% endif %}
            </div>
          </div>

          <div class="flex flex-wrap items-center gap-3">
            <button type="submit" class="btn-primary">{% if editing %}Save changes{% else %}Create service{% endif %}</button>
            {% if editing %}
              <a href="{% url 'accounts:services' %}" class="action-btn">Cancel editing</a>
            {% endif %}
          </div>
        </form>
      </div>

      <div class="card-surface p-6 md:p-8">
        <h2 class="text-2xl font-semibold text-[#0f3f46] mb-6">Existing services</h2>
        {% if services %}
          <div class="overflow-x-auto">
            <table class="table-card min-w-full">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Status</th>
                  <th class="no-wrap">Order</th>
                  <th>CTA</th>
                  <th class="no-wrap">Updated</th>
                  <th class="no-wrap">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for service in services %}
                  <tr>
                    <td class="font-semibold text-[#0f3f46]">{{ service.title }}</td>
                    <td><span class="status-pill">{{ service.get_status_display }}</span></td>
                    <td>{{ service.order }}</td>
                    <td class="text-sm text-slate-600">{{ service.cta_label|default:"—" }}</td>
                    <td class="text-sm text-slate-500">{{ service.updated|date:"M j, Y" }}</td>
                    <td>
                      <div class="table-actions">
                        <a href="{% url 'accounts:services' %}?edit={{ service.id }}" class="action-btn">Edit</a>
                        <a href="{{ service.get_absolute_url }}" class="action-btn" target="_blank" rel="noopener">Open page</a>
                        <form method="post" onsubmit="return confirm('Delete {{ service.title }}?');">
                          {% csrf_token %}
                          <input type="hidden" name="action" value="delete">
                          <input type="hidden" name="object_id" value="{{ service.id }}">
                          <button type="submit" class="action-btn">Delete</button>
                        </form>
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-slate-600 m-0">No services created yet.</p>
        {% endif %}
      </div>
    </div>
  </section>
</main>
{% endblock %}

{% block before_footer %}
  <div aria-hidden="true" class="w-full bg-brand-deep h-16"></div>
{% endblock %}
