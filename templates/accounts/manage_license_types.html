{% extends "base.html" %}
{% block title %}Manage License Types | L+C Psych{% endblock %}

{% block head_extra %}
<style>
.table-card { width: 100%; border-collapse: collapse; }
.table-card td,
.table-card th { padding: 0.75rem 1rem; border-bottom: 1px solid rgba(15, 63, 70, 0.12); text-align: left; }
.table-card th { font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(15, 63, 70, 0.68); }
.action-btn { border-radius: 0.75rem; border: 1px solid rgba(15, 63, 70, 0.14); padding: 0.45rem 0.9rem; font-size: 0.85rem; font-weight: 600; color: #0f3f46; background: #fff; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.3rem; }
.action-btn:hover,
.action-btn:focus-visible { background: #92DCE5; color: #005F6B; outline: none; box-shadow: 0 0 0 3px rgba(146, 220, 229, 0.45); }
.btn-primary { background: #3C9C64; color: #fff; border-radius: 0.75rem; padding: 0.65rem 1.6rem; font-weight: 600; border: 0; transition: background 0.2s ease, color 0.2s ease; }
.btn-primary:hover,
.btn-primary:focus-visible { background: #92DCE5; color: #005F6B; outline: none; box-shadow: 0 0 0 4px rgba(146, 220, 229, 0.45); }
.card-surface { background: #fff; border-radius: 1.25rem; box-shadow: 0 15px 40px rgba(0, 48, 57, 0.05); border: 1px solid rgba(146, 220, 229, 0.35); }
.field-label { color: #0f3f46; font-weight: 600; display: block; margin-bottom: 0.35rem; }
.input-basic { width: 100%; padding: 0.625rem 0.875rem; border-radius: 0.75rem; border: 1.5px solid rgba(146, 220, 229, 0.7); background: rgba(255, 255, 255, 0.96); transition: border-color 0.2s ease, box-shadow 0.2s ease; }
.input-basic:focus { border-color: #92DCE5; box-shadow: 0 0 0 4px rgba(146, 220, 229, 0.55); outline: none; }
.error-text { color: #b91c1c; font-size: 0.85rem; margin-top: 0.35rem; }
.badge-count { display: inline-flex; align-items: center; padding: 0.1rem 0.75rem; border-radius: 999px; background: rgba(146, 220, 229, 0.25); color: #0f3f46; font-size: 0.75rem; font-weight: 600; }
.no-wrap { white-space: nowrap; }
</style>
{% endblock %}

{% block content %}
<main id="content">
  <section class="relative overflow-hidden z-10 bg-brand-deep text-white pb-16 pt-16">
    <div class="max-w-[1100px] mx-auto px-4 text-center">
      <h1 class="text-4xl leading-tight font-semibold m-0">Manage license types</h1>
      <p class="mt-3 mx-auto max-w-[760px] text-white/90 text-lg">Create, edit, or retire the license credentials therapists can select on their profiles.</p>
    </div>
  </section>

  <section class="relative z-20 py-10 md:py-14 bg-brand-accent">
    <div class="max-w-[1100px] mx-auto px-4 space-y-10">
      <div class="card-surface p-6 md:p-8">
        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
          <div>
            <h2 class="text-2xl font-semibold text-[#0f3f46] m-0">{% if editing %}Update license type{% else %}Add a license type{% endif %}</h2>
            <p class="text-slate-600 mt-2 mb-0">{{ license_types|length }} total types. These appear anywhere a therapist chooses their credential.</p>
          </div>
          <a href="{% url 'accounts:therapists' %}" class="action-btn">Back to therapist dashboard</a>
        </div>

        {% if form.non_field_errors %}
          <div class="mt-4 text-sm text-[#b91c1c]">{{ form.non_field_errors }}</div>
        {% endif %}

        <form method="post" class="mt-6 space-y-5">
          {% csrf_token %}
          {% if editing %}
            <input type="hidden" name="object_id" value="{{ editing.id }}">
          {% endif %}
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="field-label" for="id_name">Name</label>
              {{ form.name }}
              {% if form.name.errors %}
                <div class="error-text">{{ form.name.errors|striptags }}</div>
              {% endif %}
            </div>
            <div>
              <label class="field-label" for="id_description">Description <span class="text-xs text-slate-500">(optional)</span></label>
              {{ form.description }}
              {% if form.description.errors %}
                <div class="error-text">{{ form.description.errors|striptags }}</div>
              {% endif %}
            </div>
          </div>
          <div class="flex flex-wrap items-center gap-3">
            <button type="submit" class="btn-primary">{% if editing %}Save changes{% else %}Add license type{% endif %}</button>
            {% if editing %}
              <a href="{% url 'accounts:license_types' %}" class="action-btn">Cancel editing</a>
            {% endif %}
          </div>
        </form>
      </div>

      <div class="card-surface p-6 md:p-8">
        <h2 class="text-2xl font-semibold text-[#0f3f46] mb-6">Existing license types</h2>
        {% if license_types %}
          <div class="overflow-x-auto">
            <table class="table-card min-w-full">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Description</th>
                  <th class="no-wrap">Therapists</th>
                  <th class="no-wrap">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for item in license_types %}
                  <tr>
                    <td class="font-semibold text-[#0f3f46]">{{ item.name }}</td>
                    <td class="text-sm text-slate-600">{{ item.description|default:"â€”" }}</td>
                    <td><span class="badge-count">{{ item.therapist_count }}</span></td>
                    <td class="space-y-2">
                      <a href="{% url 'accounts:license_types' %}?edit={{ item.id }}" class="action-btn">Edit</a>
                      <form method="post" onsubmit="return confirm('Delete {{ item.name }}?');">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="object_id" value="{{ item.id }}">
                        <button type="submit" class="action-btn">Delete</button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-slate-600 m-0">No license types recorded yet.</p>
        {% endif %}
      </div>
    </div>
  </section>
</main>
{% endblock %}

{% block before_footer %}
  <div aria-hidden="true" class="w-full bg-brand-deep h-16"></div>
{% endblock %}
