{% extends "base.html" %}
{% block title %}SEO Settings | L+C Psych{% endblock %}

{% block head_extra %}
<style>
.table-card { width: 100%; border-collapse: collapse; }
.table-card td,
.table-card th { padding: 0.75rem 1rem; border-bottom: 1px solid rgba(15, 63, 70, 0.12); text-align: left; }
.table-card th { font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: rgba(15, 63, 70, 0.68); }
.action-btn { border-radius: 0.75rem; border: 1px solid rgba(15, 63, 70, 0.14); padding: 0.45rem 0.9rem; font-size: 0.85rem; font-weight: 600; color: #0f3f46; background: #fff; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.3rem; }
.action-btn:hover,
.action-btn:focus-visible { background: #92DCE5; color: #005F6B; outline: none; box-shadow: 0 0 0 3px rgba(146, 220, 229, 0.45); }
.btn-primary { background: #3C9C64; color: #fff; border-radius: 0.75rem; padding: 0.65rem 1.6rem; font-weight: 600; border: 0; transition: background 0.2s ease, color 0.2s ease; }
.btn-primary:hover,
.btn-primary:focus-visible { background: #92DCE5; color: #005F6B; outline: none; box-shadow: 0 0 0 4px rgba(146, 220, 229, 0.45); }
.card-surface { background: #fff; border-radius: 1.25rem; box-shadow: 0 15px 40px rgba(0, 48, 57, 0.05); border: 1px solid rgba(146, 220, 229, 0.35); }
.field-label { color: #0f3f46; font-weight: 600; display: block; margin-bottom: 0.35rem; }
.help-text { margin-top: 0.25rem; font-size: 0.85rem; color: rgba(15, 63, 70, 0.7); }
.input-basic { width: 100%; padding: 0.625rem 0.875rem; border-radius: 0.75rem; border: 1.5px solid rgba(146, 220, 229, 0.7); background: rgba(255, 255, 255, 0.96); transition: border-color 0.2s ease, box-shadow 0.2s ease; }
.input-basic:focus { border-color: #92DCE5; box-shadow: 0 0 0 4px rgba(146, 220, 229, 0.55); outline: none; }
.error-text { color: #b91c1c; font-size: 0.85rem; margin-top: 0.35rem; }
.status-pill { display: inline-flex; align-items: center; padding: 0.15rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; background: rgba(146, 220, 229, 0.25); color: #0f3f46; text-transform: uppercase; letter-spacing: 0.05em; }
.small-note { font-size: 0.9rem; color: rgba(15, 63, 70, 0.75); }
.no-wrap { white-space: nowrap; }
</style>
{% endblock %}

{% block content %}
<main id="content">
  <section class="relative overflow-hidden z-10 bg-brand-deep text-white pb-16 pt-16">
    <div class="max-w-[1100px] mx-auto px-4 text-center">
      <h1 class="text-4xl leading-tight font-semibold m-0">SEO settings</h1>
      <p class="mt-3 mx-auto max-w-[760px] text-white/90 text-lg">Manage titles, descriptions, keywords, and social images for your static pages.</p>
    </div>
  </section>

  <section class="relative z-20 py-10 md:py-14 bg-brand-accent">
    <div class="max-w-[1100px] mx-auto px-4 space-y-10">
      <div class="card-surface p-6 md:p-8">
        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-6">
          <div>
            <h2 class="text-2xl font-semibold text-[#0f3f46] m-0">Local SEO (NAP + maps)</h2>
            <p class="small-note">Keep name, address, phone, hours, and map embed consistent for local search.</p>
          </div>
          <div class="flex flex-wrap gap-2">
            <a class="action-btn" href="{% url 'django.contrib.sitemaps.views.sitemap' %}" target="_blank" rel="noopener">XML sitemap</a>
            <a class="action-btn" href="{% url 'location_xml' %}" target="_blank" rel="noopener">Location XML</a>
            <a class="action-btn" href="/sitemap.xml" target="_blank" rel="noopener">Canonical sitemap</a>
          </div>
        </div>

        <form method="post" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="local_seo" />
          {{ contact_form.heading.as_hidden }}
          {{ contact_form.office_title.as_hidden }}
          {{ contact_form.office_hours_title.as_hidden }}
          {{ contact_form.contact_title.as_hidden }}
          {{ contact_form.phone_label.as_hidden }}
          {{ contact_form.fax_label.as_hidden }}
          {{ contact_form.fax_number.as_hidden }}
          {{ contact_form.email_label.as_hidden }}
          {{ contact_form.cta_label.as_hidden }}
          {{ contact_form.is_active.as_hidden }}
          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="field-label" for="{{ contact_form.office_address.id_for_label }}">Office address (NAP)</label>
              {{ contact_form.office_address }}
              {% if contact_form.office_address.errors %}<div class="error-text">{{ contact_form.office_address.errors|striptags }}</div>{% endif %}
              <p class="help-text">Use line breaks for street / suite / city, state ZIP.</p>
            </div>
            <div>
              <label class="field-label" for="{{ contact_form.phone_number.id_for_label }}">Primary phone</label>
              {{ contact_form.phone_number }}
              {% if contact_form.phone_number.errors %}<div class="error-text">{{ contact_form.phone_number.errors|striptags }}</div>{% endif %}
              <p class="help-text">This number is used in schema and sitewide call links.</p>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="field-label" for="{{ contact_form.email_address.id_for_label }}">Public email</label>
              {{ contact_form.email_address }}
              {% if contact_form.email_address.errors %}<div class="error-text">{{ contact_form.email_address.errors|striptags }}</div>{% endif %}
            </div>
            <div>
              <label class="field-label" for="{{ contact_form.office_hours.id_for_label }}">Office hours</label>
              {{ contact_form.office_hours }}
              {% if contact_form.office_hours.errors %}<div class="error-text">{{ contact_form.office_hours.errors|striptags }}</div>{% endif %}
              <p class="help-text">One line per rule, e.g., Mon - Thurs: 8AM - 9PM</p>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="field-label" for="{{ contact_form.map_embed_url.id_for_label }}">Map embed URL</label>
              {{ contact_form.map_embed_url }}
              {% if contact_form.map_embed_url.errors %}<div class="error-text">{{ contact_form.map_embed_url.errors|striptags }}</div>{% endif %}
              <p class="help-text">Google Maps embed src for the iframe.</p>
            </div>
            <div>
              <label class="field-label" for="{{ contact_form.directions_url.id_for_label }}">Directions URL</label>
              {{ contact_form.directions_url }}
              {% if contact_form.directions_url.errors %}<div class="error-text">{{ contact_form.directions_url.errors|striptags }}</div>{% endif %}
              <p class="help-text">Link for “Get Directions” buttons.</p>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="field-label" for="{{ contact_form.cta_url.id_for_label }}">Scheduling URL</label>
              {{ contact_form.cta_url }}
              {% if contact_form.cta_url.errors %}<div class="error-text">{{ contact_form.cta_url.errors|striptags }}</div>{% endif %}
              <p class="help-text">Used for online scheduling calls-to-action.</p>
            </div>
            <div class="flex items-end">
              <button type="submit" class="btn-primary">Save local SEO</button>
            </div>
          </div>
        </form>
      </div>

      <div class="card-surface p-6 md:p-8">
        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
          <div>
            <h2 class="text-2xl font-semibold text-[#0f3f46] m-0">{% if editing %}Update SEO entry{% else %}Add or edit SEO{% endif %}</h2>
            <p class="text-slate-600 mt-2 mb-0">Keep your static pages consistent across search and social.</p>
          </div>
          <a href="{% url 'accounts:therapists' %}" class="action-btn">Back to admin dashboard</a>
        </div>

        {% if form.non_field_errors %}
          <div class="mt-4 text-sm text-[#b91c1c]">{{ form.non_field_errors }}</div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" class="mt-6 space-y-5">
          {% csrf_token %}
          {% if editing %}
            <input type="hidden" name="object_id" value="{{ editing.id }}">
          {% endif %}

          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="field-label" for="{{ form.page_name.id_for_label }}">Page name</label>
              {{ form.page_name }}
              {% if form.page_name.errors %}<div class="error-text">{{ form.page_name.errors|striptags }}</div>{% endif %}
            </div>
            <div>
              <label class="field-label" for="{{ form.slug.id_for_label }}">Slug</label>
              {{ form.slug }}
              {% if form.slug.errors %}<div class="error-text">{{ form.slug.errors|striptags }}</div>{% endif %}
              {% if form.slug.help_text %}<p class="help-text">{{ form.slug.help_text }}</p>{% endif %}
            </div>
          </div>

          <div>
            <label class="field-label" for="{{ form.seo_title.id_for_label }}">SEO title</label>
            {{ form.seo_title }}
            {% if form.seo_title.errors %}<div class="error-text">{{ form.seo_title.errors|striptags }}</div>{% endif %}
          </div>

          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="field-label" for="{{ form.seo_description.id_for_label }}">Meta description</label>
              {{ form.seo_description }}
              {% if form.seo_description.errors %}<div class="error-text">{{ form.seo_description.errors|striptags }}</div>{% endif %}
            </div>
            <div>
              <label class="field-label" for="{{ form.seo_keywords.id_for_label }}">Keywords (optional)</label>
              {{ form.seo_keywords }}
              {% if form.seo_keywords.errors %}<div class="error-text">{{ form.seo_keywords.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div>
            <label class="field-label" for="{{ form.seo_image_url.id_for_label }}">Social image URL</label>
            {{ form.seo_image_url }}
            {% if form.seo_image_url.errors %}<div class="error-text">{{ form.seo_image_url.errors|striptags }}</div>{% endif %}
            <p class="help-text">Use an absolute or /static URL for og:image and Twitter cards.</p>
          </div>

          <div>
            <label class="field-label" for="{{ form.seo_image_file.id_for_label }}">Upload social image</label>
            {{ form.seo_image_file }}
            {% if form.seo_image_file.errors %}<div class="error-text">{{ form.seo_image_file.errors|striptags }}</div>{% endif %}
            <p class="help-text">If uploaded, this image is used for og:image. Leave blank to keep the current file or use the URL instead.</p>
            {% if editing and editing.seo_image_file %}
              <p class="help-text mt-2">Current image:</p>
              <img src="{{ editing.seo_image_file.url }}" alt="Current social image" class="max-h-40 rounded-lg border border-slate-200"/>
            {% endif %}
          </div>

          <div class="flex flex-wrap items-center gap-3">
            <button type="submit" class="btn-primary">{% if editing %}Save changes{% else %}Save SEO{% endif %}</button>
            {% if editing %}
              <a href="{% url 'accounts:seo_settings' %}" class="action-btn">Cancel editing</a>
              {% if editing.slug not in default_slugs %}
                <button type="submit" name="action" value="delete" class="action-btn" onclick="return confirm('Delete this SEO entry?');">Delete</button>
              {% endif %}
            {% endif %}
          </div>
        </form>
      </div>

      <div class="card-surface p-6 md:p-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
          <div>
            <h2 class="text-2xl font-semibold text-[#0f3f46] m-0">Static pages</h2>
            <p class="small-note">Click edit to adjust SEO for each page.</p>
          </div>
          <a href="{% url 'accounts:seo_settings' %}" class="action-btn">Add new entry</a>
        </div>
        {% if entries %}
          <div class="overflow-x-auto">
            <table class="table-card min-w-full">
              <thead>
                <tr>
                  <th>Page</th>
                  <th>Slug</th>
                  <th>SEO title</th>
                  <th class="no-wrap">Updated</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for entry in entries %}
                  <tr>
                    <td class="font-semibold text-[#0f3f46]">{{ entry.page_name }}</td>
                    <td>{{ entry.slug }}</td>
                    <td>{{ entry.seo_title|default:"(uses fallback)" }}</td>
                    <td class="no-wrap">{{ entry.updated|date:"Y-m-d" }}</td>
                    <td class="no-wrap text-right">
                      <a href="{% url 'accounts:seo_settings' %}?edit={{ entry.id }}" class="action-btn">Edit</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-slate-600">No SEO entries yet. Add one above.</p>
        {% endif %}
      </div>
    </div>
  </section>
</main>
{% endblock %}
