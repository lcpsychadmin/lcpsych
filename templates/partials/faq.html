{% with faq_items as faqs %}
{% if faqs %}

<div id="faq-wrapper">
<style>
#faq-wrapper a { color: #005F6B; }
#faq-wrapper a:hover { color: #3C9C64; }
#faq-wrapper .prose a { color: #005F6B; text-decoration: underline; }
#faq-wrapper .prose a:hover { color: #3C9C64; }
#faq-wrapper [data-faq-toggle]:focus-visible { outline-color: #92DCE5; }
#faq-wrapper [data-faq-item] { border: 1px solid #92DCE5 !important; box-shadow: none !important; }
#faq-wrapper [data-faq-item]:hover { border-color: #3C9C64 !important; box-shadow: 0 8px 20px rgba(0,0,0,0.06) !important; }
#faq-wrapper [data-faq-toggle]:hover { background: #E8F6F8; }
#faq-wrapper [data-faq-toggle] span[aria-hidden="true"] { color: #0f3f46; }
#faq-wrapper [data-faq-toggle] { border: 1px solid transparent !important; }
#faq-wrapper [data-faq-toggle]:hover { border-color: #92DCE5 !important; }
#faq-wrapper [data-faq-item] * { box-shadow: none !important; outline-color: #92DCE5 !important; }
#faq-wrapper [data-faq-answer] { border-top: 1px solid #d9e6ea !important; }
#faq-wrapper input#faq-search { border-color: #92DCE5 !important; }
#faq-wrapper button[type="submit"] { background: #92DCE5; color: #0f3f46; border: 1px solid transparent !important; box-shadow: none; }
#faq-wrapper button[type="submit"]:hover { background: #E8F6F8 !important; color: #0f3f46 !important; border-color: #92DCE5 !important; }
#faq-wrapper a[href="/faq/"] { border-color: rgba(255,255,255,0.5) !important; }
#faq-wrapper a[href="/faq/"]:hover { border-color: #92DCE5 !important; }
</style>

<section class="relative overflow-hidden bg-brand-deep text-white">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(146,220,229,0.18),transparent_32%),radial-gradient(circle_at_80%_0%,rgba(255,255,255,0.12),transparent_32%)]"></div>
    <div class="relative max-w-5xl mx-auto px-4 py-16 md:py-20 text-center space-y-5">
        <div class="inline-flex items-center rounded-full bg-white/15 px-3 py-1 text-xs font-semibold uppercase tracking-wide">Frequently Asked Questions</div>
        <h1 class="text-3xl md:text-4xl font-semibold m-0">Find answers quickly</h1>
        <p class="text-lg text-white/85 max-w-3xl mx-auto m-0">Search common questions about services, scheduling, insurance, and getting matched with a clinician.</p>
        <form action="/faq/" method="get" class="max-w-3xl mx-auto">
            <div class="flex flex-col sm:flex-row gap-3 sm:gap-2 items-stretch">
                <input id="faq-search" name="q" value="{{ request.GET.q }}" type="search" placeholder="Search FAQs (e.g., insurance, evaluation, telehealth)" class="w-full rounded-xl border border-white/30 bg-white/10 px-4 py-3 text-white placeholder:text-white/70 focus:border-[#92DCE5] focus:ring-4 focus:ring-[#92DCE5]/50 focus:outline-none hover:border-[#92DCE5]" />
                <button type="submit" class="rounded-xl bg-[#92DCE5] px-5 py-3 text-sm font-semibold text-[#0f3f46] shadow-sm transition-colors hover:bg-[#E8F6F8] hover:text-[#0f3f46] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white">Search</button>
                {% if request.GET.q %}
                    <a href="/faq/" class="rounded-xl border border-white/40 px-4 py-3 text-sm font-semibold text-white transition-colors hover:bg-[#E8F6F8] hover:text-[#0f3f46] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white">Clear</a>
                {% endif %}
            </div>
        </form>
    </div>
</section>

<section class="bg-brand-accent py-12 md:py-16">
    <div class="max-w-4xl mx-auto px-4">
        <div id="faq-list" class="space-y-3">
            {% for faq in faqs %}
            <div class="rounded-xl bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden" data-faq-item>
                <button type="button" class="w-full flex justify-between items-start gap-3 text-left px-5 py-4 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#92DCE5]" data-faq-toggle aria-expanded="false">
                    <div class="space-y-1">
                        <p class="text-base md:text-lg font-semibold text-[#0f3f46] m-0">{{ faq.question }}</p>
                    </div>
                    <span class="mt-1 inline-flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-[#E8F6F8] text-[#0f3f46]" aria-hidden="true">+
                    </span>
                </button>
                <div class="px-5 pb-5 hidden" data-faq-answer>
                    <div class="prose prose-sm max-w-none text-slate-800">{{ faq.answer|safe }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        <p id="faq-empty" class="mt-6 text-center text-slate-700 hidden">No FAQs match that search. Try a different term.</p>
    </div>

    <script>
        (function() {
            const list = document.getElementById('faq-list');
            if (!list) return;
            const search = document.getElementById('faq-search');
            const items = Array.from(list.querySelectorAll('[data-faq-item]'));
            const empty = document.getElementById('faq-empty');

            function setExpanded(item, expanded) {
                const btn = item.querySelector('[data-faq-toggle]');
                const ans = item.querySelector('[data-faq-answer]');
                const icon = btn.querySelector('span[aria-hidden="true"]');
                btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
                if (ans) ans.classList.toggle('hidden', !expanded);
                    if (icon) icon.textContent = expanded ? '-' : '+'; // minus sign when open
            }

            items.forEach((item) => {
                const btn = item.querySelector('[data-faq-toggle]');
                btn.addEventListener('click', () => {
                    const expanded = btn.getAttribute('aria-expanded') === 'true';
                    setExpanded(item, !expanded);
                });
            });

            function filter(query) {
                const q = (query || '').trim().toLowerCase();
                let shown = 0;
                items.forEach((item) => {
                    const text = item.textContent.toLowerCase();
                    const match = q === '' || text.includes(q);
                    item.style.display = match ? '' : 'none';
                    if (match) shown += 1;
                });
                if (empty) empty.classList.toggle('hidden', shown > 0);
            }

            if (search) {
                search.addEventListener('input', (e) => filter(e.target.value));
                const qParam = new URLSearchParams(window.location.search).get('q');
                if (qParam) filter(qParam);
                else filter(search.value || '');
            }
        })();
    </script>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {% for faq in faqs %}
            {
                "@type": "Question",
                "name": "{{ faq.question|escapejs }}",
                "acceptedAnswer": {"@type": "Answer", "text": "{{ faq.answer|striptags|escapejs }}"}
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]
    }
    </script>
</section>

</div>

{% endif %}
{% endwith %}